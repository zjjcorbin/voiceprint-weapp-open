<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-avatar">
      <image src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" wx:if="{{userInfo.avatarUrl}}"></image>
      <view class="avatar-placeholder" wx:else>
        <text class="avatar-text">{{userInfo.name ? userInfo.name.charAt(0) : 'ç”¨'}}</text>
      </view>
    </view>
    <view class="user-info">
      <text class="user-name">{{userInfo.name || 'æœªè®¾ç½®'}}</text>
      <text class="user-department">{{userInfo.department || 'æœªè®¾ç½®éƒ¨é—¨'}}</text>
      <text class="user-id">å·¥å·ï¼š{{userInfo.employeeId || 'æœªè®¾ç½®'}}</text>
    </view>
    <view class="voiceprint-status">
      <view class="status-badge {{voiceprintStatus.registered ? 'registered' : 'unregistered'}}">
        <text class="status-text">{{voiceprintStatus.registered ? 'å·²æ³¨å†Œ' : 'æœªæ³¨å†Œ'}}</text>
      </view>
    </view>
  </view>

  <!-- å£°çº¹ä¿¡æ¯ -->
  <view class="voiceprint-info" wx:if="{{voiceprintStatus.registered}}">
    <view class="info-header">
      <text class="info-title">å£°çº¹ä¿¡æ¯</text>
    </view>
    <view class="info-grid">
      <view class="info-item">
        <text class="info-label">æ ·æœ¬æ•°é‡</text>
        <text class="info-value">{{voiceprintStatus.sampleCount}}ä¸ª</text>
      </view>
      <view class="info-item">
        <text class="info-label">æ³¨å†Œæ—¶é—´</text>
        <text class="info-value">{{formatDate(voiceprintStatus.registrationTime)}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">è¯†åˆ«å‡†ç¡®ç‡</text>
        <text class="info-value">{{voiceprintStatus.accuracy}}%</text>
      </view>
      <view class="info-item">
        <text class="info-label">éªŒè¯æ¬¡æ•°</text>
        <text class="info-value">{{verificationStats.totalCount}}æ¬¡</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-group">
      <text class="group-title">å£°çº¹ç®¡ç†</text>
      <view class="menu-item" bindtap="goToRegister" wx:if="{{!voiceprintStatus.registered}}">
        <view class="menu-icon register">
          <text>ğŸ¤</text>
        </view>
        <text class="menu-text">æ³¨å†Œå£°çº¹</text>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="goToVerify">
        <view class="menu-icon verify">
          <text>âœ…</text>
        </view>
        <text class="menu-text">éªŒè¯èº«ä»½</text>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="reRegister" wx:if="{{voiceprintStatus.registered}}">
        <view class="menu-icon update">
          <text>ğŸ”„</text>
        </view>
        <text class="menu-text">é‡æ–°æ³¨å†Œ</text>
        <text class="menu-arrow">></text>
      </view>
    </view>

    <view class="menu-group">
      <text class="group-title">ä½¿ç”¨ç»Ÿè®¡</text>
      <view class="menu-item" bindtap="viewVerificationHistory">
        <view class="menu-icon history">
          <text>ğŸ“Š</text>
        </view>
        <text class="menu-text">éªŒè¯å†å²</text>
        <view class="menu-badge" wx:if="{{verificationStats.recentCount > 0}}">
          <text>{{verificationStats.recentCount}}</text>
        </view>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="viewAccuracyStats">
        <view class="menu-icon stats">
          <text>ğŸ“ˆ</text>
        </view>
        <text class="menu-text">å‡†ç¡®ç‡ç»Ÿè®¡</text>
        <text class="menu-arrow">></text>
      </view>
    </view>

    <view class="menu-group">
      <text class="group-title">è®¾ç½®</text>
      <view class="menu-item" bindtap="editProfile">
        <view class="menu-icon edit">
          <text>âœï¸</text>
        </view>
        <text class="menu-text">ç¼–è¾‘èµ„æ–™</text>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="viewPrivacyPolicy">
        <view class="menu-icon privacy">
          <text>ğŸ”’</text>
        </view>
        <text class="menu-text">éšç§æ”¿ç­–</text>
        <text class="menu-arrow">></text>
      </view>
      <view class="menu-item" bindtap="contactSupport">
        <view class="menu-icon support">
          <text>ğŸ’¬</text>
        </view>
        <text class="menu-text">è”ç³»æ”¯æŒ</text>
        <text class="menu-arrow">></text>
      </view>
    </view>
  </view>

  <!-- éªŒè¯å†å²åˆ—è¡¨ -->
  <view class="history-section" wx:if="{{verificationHistory.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘éªŒè¯è®°å½•</text>
      <text class="view-all" bindtap="viewAllHistory">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="history-list">
      <view class="history-item {{item.success ? 'success' : 'fail'}}" 
            wx:for="{{verificationHistory}}" wx:key="id" 
            bindtap="viewHistoryDetail" data-id="{{item.id}}">
        <view class="history-time">{{formatDateTime(item.createdAt)}}</view>
        <view class="history-result">
          <text class="result-text">{{item.success ? 'æˆåŠŸ' : 'å¤±è´¥'}}</text>
          <text class="confidence" wx:if="{{item.success}}">{{item.confidence * 100}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <view class="logout-section">
    <button class="logout-btn" bindtap="logout">
      <text>é€€å‡ºç™»å½•</text>
    </button>
  </view>
</view>

<!-- ç¼–è¾‘èµ„æ–™å¼¹çª— -->
<view class="edit-modal" wx:if="{{showEditModal}}">
  <view class="modal-overlay" bindtap="closeEditModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">ç¼–è¾‘èµ„æ–™</text>
      <text class="modal-close" bindtap="closeEditModal">âœ•</text>
    </view>
    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">å§“å</text>
        <input class="form-input" 
               placeholder="è¯·è¾“å…¥å§“å" 
               value="{{editForm.name}}" 
               bindinput="onNameInput" />
      </view>
      <view class="form-item">
        <text class="form-label">éƒ¨é—¨</text>
        <input class="form-input" 
               placeholder="è¯·è¾“å…¥éƒ¨é—¨" 
               value="{{editForm.department}}" 
               bindinput="onDepartmentInput" />
      </view>
      <view class="form-item">
        <text class="form-label">å·¥å·</text>
        <input class="form-input" 
               placeholder="è¯·è¾“å…¥å·¥å·" 
               value="{{editForm.employeeId}}" 
               bindinput="onEmployeeIdInput" />
      </view>
    </view>
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="closeEditModal">å–æ¶ˆ</button>
      <button class="confirm-btn" bindtap="saveProfile" disabled="{{saving}}">
        <text wx:if="{{!saving}}">ä¿å­˜</text>
        <text wx:else>ä¿å­˜ä¸­...</text>
      </button>
    </view>
  </view>
</view>